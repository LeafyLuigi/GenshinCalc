@use "sass:list";
@use "sass:math";
@use "sass:string";

/*"Theme" Fallbacks*/
body {
	--page-background: #fff;
	--text-color: #000;
	--text-alt-color: #222;
	--text-alt-color-2: #495366;
	--exp-color: #00f;
	--exp-text-color: #00f;
	--invalid: #f00;
	--links: #0066cc;
	--button: #e9e9ed;
	--button-border: 2px outset #8f8f9d;
	--button-hover: #d0d0d7;
	--button-hover-border: 2px outset #676774;
	--box-border-color: #495366;
	--text-on-light-color: #222;
	--tooltip: #e9e5dc;
	--tooltip-text: #000;
	--tooltip-border: 2px solid currentcolor;
	--refinement-text: #495366;
	--refinement-background: #00000080;
	--refinement-max-text: #ffe14b;
	--refinement-max-background: #ffde4b80;
	--popup-text: #000;
	--popup-background: #ebe4d6;
	--popup-border: 2px solid #4a5366;
}
.theme-white {
	background-color: #fff;
}
.theme-dark  {
	--page-background: #1c1c22;
	--text-color: #f4e5c6;
	--text-alt-color: #968056;
	--text-alt-color-2: #e0aa45;
	--exp-color: #9f9fff;
	--exp-text-color: #9f9fff;
	--links: #3a9dff;
	--button: #484851;
	--button-border: 2px solid #86868f;
	--button-hover: #16161b;
	--tooltip: #16161b;
	--tooltip-text: #f4e5c6;
	--tooltip-border: 2px solid currentcolor;
	--refinement-text: #b4b4b4;
	--refinement-background: #00000080;
	--refinement-max-text: #ffe14b;
	--refinement-max-background: #ffde4b80;
	// --popup-text: #000;
	// --popup-background: #ebe4d6;
	// --popup-border: 2px solid #4a5366;
}
.theme-light {
	background-color: #fff;
	color: #8599a8;
}
.theme-ganyu {

}
.theme-knave {
	--page-background: #1c1c22;
	--text-color: #FBFAFF;
	--text-alt-color: #9A95A5;
	--text-alt-color-2: #9A95A5;
	--exp-color: #8E1F22;
	--exp-text-color: #da0e15;
	--links: #da0e15;
	--button: #272439;
	--button-border: 2px solid #8E1F22;
	--button-hover: #131318;
	--tooltip: #131318;
	--tooltip-text: #FBFAFF;
	--tooltip-border: 2px solid #8E1F22;
}
body {
	background: var(--page-background);
	color: var(--text-color);
	line-height: 1.6;
	font-family: sans-serif;
	direction: ltr;
}
:link {
	color: var(--links);
}
.capitalize {
	text-transform: capitalize;
}
.loading {
	display: flex;
	justify-content: center;
	align-items: center;
	width: 100%;
	&Spin {
		filter:	drop-shadow(0 0 3px var(--text-color));
	}
	&Text {
		display: none;
	}
}
@media (prefers-reduced-motion) {
	.loadingSpin {
		display: none;
	}
	.loadingText {
		display: block;
	}
}
@media (prefers-reduced-motion) {
	body.noAnimation {
		.loadingText {
			display: block;
		}
		.loadingSpin {
			display: none;
		}
	}
}
body:not(.showConverts) {
	#converts,
	#convertsTotal {
		display: none !important;
	}
}
.hideLimited .limited {
	display: none !important;
}
.fakeTextbox {
	overflow: auto;
	resize: both;
	&:empty {
		display: none;
	}
}
.notes {
	font-style: italic;
	margin-bottom: 4px;
}
.addButtons {
	display: flex;
	margin-bottom: 4px;
	align-items: center;
	gap: 8px;
}
.vertFlex {
	display: flex;
	flex-flow: column wrap;
	margin-bottom: 8px;
}
.defaultInput {
	margin-inline: 2px;
}
.alignEnd {
	align-items: end;
}
.invBlock {
	margin-top: 8px;
	&.empty {
		display:none;
	}
}
.fakeTextbox, .charBlock, .invBlock {
	border: 1px solid var(--box-border-color);
	border-radius: 8px;
	padding: 8px;
	margin-bottom: 8px;
}
.charWeapInputs {
	input {
		&:invalid {
			outline: 2px solid var(--invalid);
			outline-offset: 1px;
		}
	}
}
.charBlock input {
	margin-inline: 2px;
}
.boxName {
	font-size: 24px;
	font-weight: 600;
	gap: 4px;
	display: flex;
	align-items: center;
	> img:not([src*="/icons/"]) {
		width: 64px;
		height: 64px;
	}
}
.boxTitle {
	font-size: 20px;
}
.boxSubtitle {
	font-size: 16px;
}
.topFlex {
	display: flex;
	justify-content: space-between;
}
.removeButton {
	height: fit-content;
}
:is(.charDropdown,.weaponDropdown) {
	position: relative;
	max-width: 200px;
	min-width: 200px;
	> .fauxButton {
		min-height: 48px;
		min-width: inherit;
		display: flex;
		align-items: center;
		max-width: inherit;
		> img {
			margin-right: 8px;
		}
	}
	input {
		max-width: 136px;
	}
	&:is(:focus-within,:hover,.active) {
		.dropdownContent {
			display: block;
		}
	}
}
.weaponDropdown.unusedFound {
	&:hover, & {
		.dropdownContent {
			display: none;
		}
	}
	.unusedWeaponsDropdown {
		display: block;
	}
}
.unusedWeaponsDropdown {
	display: none;
	position: absolute;
	z-index: 1;
	max-height: 250px;
	overflow-y: scroll;
	min-width: inherit;
	scrollbar-width: thin;
}
.dropdownContent {
	display: none;
	position: absolute;
	z-index: 1;
	max-height: 250px;
	overflow-y: scroll;
	min-width: inherit;
	scrollbar-width: thin;
	> .fauxButton {
		display: flex;
		justify-content: space-between;
		min-width: 100%;
		max-width: inherit;
		> span:not([class]) {
			display: flex;
			align-items: center;
			> img:not([src*="icons"]) {
				margin-right: 10px;
			}
		}
		&[disabled],&:disabled {
			display: none;
		}
	}
}
.dropdownWeaponImg,.dropdownCharImg {
	width: 32px;
}
.dropdownType {
	float: right;
}
#inputs:not(:empty) {
	margin-top: 8px;
}
:is(.testButton,.submitButton,.clearInvButton) {
	white-space: unset;
	display: inline-block;
	height: fit-content;
	margin-right: 4px;
	margin-block: 4px;
}
.itemIconContainer {
	display: flex;
	flex-direction: column;
	align-items: center;
	--size: 256px;
	--rarity-size: 55px;
}
.itemIcon, .partyCharIcon {
	transform: rotate(0deg);
	display: flex;
	flex-flow: column nowrap;
	align-items: center;
	justify-content: center;
	color: var(--icon-color);
	height: calc(var(--size) * (17 / 14));
	width: var(--size);
	line-height: 1;
	font-size: calc(var(--size) * (3 / 14));
	border-radius: calc(var(--size) / 10);
	background: top/cover no-repeat;
}
.itemCount {
	color: var(--text-on-light-color);
}
.partyCharIcon {
	height: var(--size);
	min-height: var(--size);
}
.normal {
	--size: 112px;
	--vision-size: 32px;
	--rarity-size: 24px;
}
.small {
	--size: 96px;
	--vision-size: 24px;
	--rarity-size: 20px;
}
.mini {
	--size: 72px;
	--vision-size: 20px;
	--rarity-size: 15px;
}
.tiny {
	--size: 56px;
	--vision-size: 15px;
	--rarity-size: 12px;
}
.micro {
	--size: 36px;
	--vision-size: 12px;
	--rarity-size: 8px;
}
$rarities: (
	(1 #a2a2a2 #707275),
	(2 #6cad8d #5c7670),
	(3 #6eaace #667896),
	(4 #9674c5 #65608c),
	(5 #e09552 #946a43)
);
@each $rarity in $rarities {
	.rarity-#{list.nth($rarity,1)} {
		@if list.nth($rarity,1) == 1 {
			:is(.rarity-0, & ) {
				background-color: list.nth($rarity,2);
				background-image: linear-gradient(to bottom, list.nth($rarity,3) 0%, list.nth($rarity,2) 100%);
				background-image: url("images/rarity/"+#{list.nth($rarity,1)}+".png");
			}
		} @else {
			background-color: list.nth($rarity,2);
			background-image: linear-gradient(to bottom, list.nth($rarity,3) 0%, list.nth($rarity,2) 100%);
			background-image: url("images/rarity/"+#{list.nth($rarity,1)}+".png");
		}
	}
	:is(.micro,.tiny,.mini,.small,.normal) .itemIcon {
		@if list.nth($rarity,1) == 1 {
			&:is(.rarity-0,.rarity-1) {
				background: list.nth($rarity,2) none;
				background: linear-gradient(to bottom, list.nth($rarity,3) 0%, list.nth($rarity,2) 82.35%, 82.36%, #e9e5dc 100%) top/cover no-repeat, transparent;
				background: url("images/rarity/mini-"+#{list.nth($rarity,1)}+".png") top/cover no-repeat, transparent;
			}
		} @else {
			&.rarity-#{list.nth($rarity,1)} {
				background: list.nth($rarity,2) none;
				background: linear-gradient(to bottom, list.nth($rarity,3) 0%, list.nth($rarity,2) 82.35%, 82.36%, #e9e5dc 100%) top/cover no-repeat, transparent;
				background: url("images/rarity/mini-"+#{list.nth($rarity,1)}+".png") top/cover no-repeat, transparent;
			}
		}
	}
};
$mixedRarities: (
	("13" (#a2a2a2 #6cad8d #6eaace)),
	("34" (#6eaace #9674c5)),
	("45" (#9674c5 #e09552))
);
@each $mix in $mixedRarities {
	.rarity-#{list.nth($mix,1)} {
		$cols: list.nth($mix,2);
		$offset: 0.625;
		$gLen: math.div(1, list.length($cols));
		@if list.length($cols) == 3 {
			$offset: 0.5;
		}
		$g: "from "+($offset - $gLen)+"turn, ";
		@for $i from length($cols) through 1 {
			$g: #{$g}+""+#{list.nth($cols,$i)}+" "+(1 - ($i * $gLen))+"turn "+(1 - (($i - 1) * $gLen))+"turn,";
		}
		background: #{list.nth($cols,1)} !important;
		background: conic-gradient(string.slice($g, 0, -2)) top/auto var(--size) no-repeat, #e9e5dc !important;
		background: url("images/rarity/mini-"+#{list.nth($mix,1)}+".png") top/cover no-repeat, transparent !important;
	}
}
.itemIconImg {
	height: var(--size);
	width: var(--size);
	border-radius: calc(var(--size) / 10);
}
.itemName {
	color: var(--text-alt-color-2);
	line-height: 1;
	font-size: calc(var(--size) * (3 / 14));
	text-align: center;
	overflow-wrap: normal;
	min-width: 100%;
	max-width: 100%;
	width: min-content;
}
.userInvInput {
	border: 0;
	margin: 0;
	background-color: transparent;
	color: var(--text-on-light-color);
	max-height: calc(var(--size) * (3 / 14));
	line-height: 1;
	max-width: var(--size);
	box-sizing: border-box;
	padding-block: 0;
	padding-inline: 2px;
	// &:focus {
	// 	outline: 0;
	// }
}


.outputRequired {
	display: flex;
	flex-wrap: wrap;
	// justify-content: space-evenly;
	gap: 4px;
}

.itemSource {
	display: block;
	position: absolute;
	top: 0;
	right: 0;
	background: url(images/icons/info.svg);
}
.itemSourceTooltip {
	display: inline-block;
	visibility: hidden;
	color: var(--tooltip-text);
	background: var(--tooltip);
	border: var(--tooltip-border);
	border-radius: 8px;
	padding: 4px;
	position: absolute;
	z-index: 1;
	width: 120px;
	bottom: 110%;
	left: 0;
	text-align: center;
	user-select: none;
	font-size: 14px;
	.itemSource:hover+&,
	.active+& {
		visibility: visible;
	}
}

.convert {
	display: none;
	.showConvert & {
		display: block;
	}
}

.fauxButton {
	border: var(--button-border);
	background-color: var(--button);
	color: var(--text-color);
	padding-block: 1px;
	padding-inline: 4px;
	cursor: default;
	box-sizing: border-box;
	border-radius: 8px;
	&:hover {
		color: var(--text-color);
		border: var(--button-hover-border);
		background-color: var(--button-hover);
	}
	&.disabled {
		cursor: unset;
		pointer-events: none;
		opacity: 0.6;
	}
}
:is(.charDropdownButton, .weaponDropdownButton, .partyPopupWeapon) {
	font-size: 14px;
	&:is(.rarity-0,.rarity-1,.rarity-2,.rarity-3,.rarity-4,.rarity-5){
		background-position: -1px 0px;
	}
	&:is(.rarity-0,.rarity-1) {
		background-image: linear-gradient(to right, #707275, #a2a2a2 20%, transparent 44px);
	}
	&.rarity-2 {
		background-image: linear-gradient(to right, #5c7670, #6cad8d 20%, transparent 44px);
	}
	&.rarity-3 {
		background-image: linear-gradient(to right, #667896, #6eaace 20%, transparent 44px);
	}
	&.rarity-4 {
		background-image: linear-gradient(to right, #65608c, #9674c5 20%, transparent 44px);
	}
	&.rarity-5 {
		background-image: linear-gradient(to right, #946a43, #e09552 20%, transparent 44px);
	}
}

.rarityIcon {
	position: absolute;
	height: var(--rarity-size);
	top: calc(var(--size) - var(--rarity-size));
	.partyCharIcon & {
		top: unset;
		bottom: calc(-1 * var(--rarity-size));
	}
}

.hideExtraIcons .extraIcon {
	display: none;
}
.iconsGroup {
	display: flex;
	max-height: 32px;
	align-items: center;
	align-self: center;
	&:empty {
		display: none;
	}
}
.vision {
	filter: drop-shadow(0 0 2px #0006);
}
.partyCharImage {
	position: absolute;
	top: 0;
	border-radius: inherit;
	height: var(--size);
	width: var(--size);
}
.partyCharType {
	position: absolute;
	top: 4px;
	left: 4px;
	filter: drop-shadow(0 0 3px #0006);
	height: var(--vision-size);
	width: var(--vision-size);
}
.partyTravType.unsetType {
	display: none;
}
.partyChars {
	padding: 4px;
	display: flex;
	gap: 4px;
	height: 260px;
	.partyChar:is(.normal),
	.partyAddChar {
		width: 220px;
		max-height: 260px;
	}
	.partyAddChar {
		height: 260px;
	}
}
.partyChar {
	display: flex;
	flex-direction: column;
	align-items: center;
	:is(.partyPopupContent, &) {
		&>.limited:not(.partyIntractable),
		&>div:not([class]) {
			display: flex;
			flex-direction: column;
			align-items: center;
			min-height: calc(var(--size) + (2 * var(--rarity-size)));
			height: calc(var(--size) + (2 * var(--rarity-size)));
		}
	}
}
.partyArtifacts {
	display: flex;
	flex-wrap: wrap;
}
.partyWeaponArtiGroup {
	display: flex;
	justify-content: center;
}
.partyAddChar { 
	background: url(images/icons/addChar.svg) center/30% no-repeat;
	filter: drop-shadow(0 0 5px #88f3ff);
	.party:not([popupdisabled]) &:hover {
		filter: drop-shadow(0 0 5px #88f3ff) drop-shadow(0 0 5px #88f3ff);
	}
	&.open {
		filter: none;
	}
	&.partyFull {
		display: none;
	}
}
.noEvents, .noEvents * {
	pointer-events: none;
}
.allowEvents {
	pointer-events: initial;
}
.partyCharName {
	text-align: center;
}
.partyPopupTravelerType {
	display: flex;
	align-items: center;
	img {
		margin-right: 8px;
	}
}
.partyPopup {
	.partyChar & {
		max-height: 260px;
		position: absolute;
		transform: translateX(90%);
		z-index: 1;
		background: #ebe4d6;
		border: 2px solid #4a5366;
		border-radius: 4px;
		.partyPopupContent {
			max-height: 100px;
		}
	}
	.partyAddChar & {
		position: absolute;
		z-index: 1;
		width: fit-content;
		background: #ebe4d6;
		border: 2px solid #4a5366;
		border-radius: 4px;
		.partyPopupContent {
			display: grid;
			padding-bottom: 10px;
			max-height: 70vh;
			grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
		}
	}
	.partyPopupHeader {
		display: flex;
		justify-content: space-between;
		padding: 0 8px;
		color: #4a5366;
		user-select: none;
		gap: 8px;
		.partyPopupClose {
			cursor: pointer;
		}
	}
	.partyArtifactImage+& {
		transform: none;
		&::before {
			content: "";
			position: absolute;
			top: -17px;
			left: 6px;
			height: 0;
			width: 0;
			border: 8px solid transparent;
			display: block;
			border-bottom-color: #4a5366;
		}
	}
	.partyPopupContent {
		overflow-y: scroll;
		&>.limited:not(.partyIntractable),
		&>div:not([class]) {
			min-height: 120px;
			max-height: 120px;
			min-width: 105px;
			max-width: 105px;
			justify-content: end;
		}
		.rarityIcon {
			display: none;
		}
	}
}
.partyIntractable {
	cursor: pointer;
	.party[popupdisabled] & {
		cursor: auto;
	}
}
.partyPopupWeapon, .partyPopupArtifact, .partyMeta>div {
	display: flex;
	align-items: center;
}
.partyCombos {
	margin-left: 1em;
	display: flex;
	&>span {
		display: inline-flex;
	}
}
.partyComboIcon {
	margin: 0 0.25em;
	display: flex;
	line-height: 1;
	background-color: black;
	border: 1px solid var(--elementColor,transparent);
	border-radius: 50px;
	height: fit-content;
	padding: 2px;
	box-shadow: 0 0 4px inset var(--elementColor,transparent), 0 0 4px var(--elementColor,transparent);
	&+& {
		margin: 0 0.25em 0 0;
	}
	&.elementTypePyro {
		--elementColor: #ef7938;
	}
	&.elementTypeHydro {
		--elementColor: #4cc2f1;
	}
	&.elementTypeElectro {
		--elementColor: #af8ec1;
	}
	&.elementTypeCryo {
		--elementColor: #9fd6e3;
	}
	&.elementTypeAnemo {
		--elementColor: #74c2a8;
	}
	&.elementTypeGeo {
		--elementColor: #fab632;
	}
	&.elementTypeDendro {
		--elementColor: #a5c83b;
	}
	&.elementTypeUnaligned {
		--elementColor: #13131e;
	}
}

.collapse {
	&:is(.charInfo,.charTravInfo),
	:is(.charInfo,.charTravInfo) {
		display: none;
	}
	&.charBlock {
		padding: 4px 8px;
		.boxName {
			font-size: 18px;
			row-gap: 0;
			> img {
				width: 24px;
				height: 24px;
				&:not([src*="/icons/"]) {
					width: 32px;
					height: 32px;
				}
			}
		}
		.alignEnd {
			padding: 4px 0 0;
			flex-flow: row-reverse nowrap;
		}
	}
}
.realName {
	font-size: smaller;
}
.conBonus {
	color: var(--exp-text-color);
	border-color: var(--exp-color);
}
.expMaxLevel {
	color: var(--text-alt-color);
}
.expBar {
	background: linear-gradient(to right, var(--exp-color) 0% var(--fill,0%), transparent var(--fill,0%) 100% );
	width: 300px;
	height: 5px;
	border: 1px solid #444;
}
.expTotal {
	color: var(--exp-text-color);
}

.hiddenDiv {
	display: none;
	.toggleNextVisible:checked + & {
		display: block;
	}
}


#links {
	a:not(:last-child) {
		margin-inline-end: 8px;
	}
}
.skipLink {
	&:not([href]) {
		display: none;
	}
	&[href] {
		font-size: 0;
		&:not(:focus) {
			margin: 0 !important;
		}
		&:focus {
			font-size: unset;
		}
	}
}

// "Equipment Module" related classes 
.equipment {
	&Details {
		summary {
			width: fit-content;
		}
		&[open] summary {
			margin-bottom: 10px;
		}
	}
	
	&Items {
		padding-block: 10px;
		display: flex;
		gap: 16px;
	}
	
	&Edit {
		position: absolute;
		top: -8px;
		right: -8px;
		padding: 0;
		border: none;
		background: none;
		font-size: 0;
		opacity: 0.5;
		&:hover,&:focus {
			opacity: 1;
		}
	}

	&PopupContainer {
		position: absolute;
		z-index: 100;
		// background: red;
		// top: 0;
		// left: 0;
		&:empty {
			display: none;
		}
	}
}

#popup {
	position: absolute;
	box-sizing: border-box;
	padding: 4px;
	color: var(--popup-text);
	background: var(--popup-background);
	border: var(--popup-border);
	min-width: 50vw;
	max-width: 80vw;
	width: fit-content;
	&.rendering {
		visibility: hidden;
		pointer-events: none;
	}
}
html.popupExists {
	overflow: hidden;
}
.popup {
	&Title:not(:empty) {
		margin-left: 4px;
	}
	&CloseButton {
		padding: 0;
		border: none;
		background: none;
	}
	&SearchContainer {
		display: block;
		padding: 4px;
		.hideSearch & {
			display: none;
		}
	}
	&Results {
		.hideSearch & {
			display: none;
		}
		display: flex;
		flex-flow: row wrap;
		gap: 4px;
		padding: 0 8px;
		justify-content: center;
	}
	&Result {
		min-width: 60px;
		min-height: 100px;
		display: flex;
		justify-content: center;
		padding: 0;
		border: none;
		background: none;
		.itemName {
			color: var(--popup-text);
		}
		// font-size: 0;
		// &Img{
		// }
		// &Name {
		// }
	}
	&Content {
		.hideContent & {
			display: none;
		}
		display: block;
	}
}

.equipDropdownReorder {
	display: none;
	&:not(:nth-child(2),:nth-child(3)) {
		display: block;
	}
}

.refinementLevel {
	// positioning here
	position: absolute;
	top: 4px;
	left: 4px;
	color: var(--refinement-text);
	background-color: var(--refinement-background);
	padding: 2px;
	border-radius: 2px;
	&.max {
		color: var(--refinement-max-text);
		background-color: var(--refinement-max-background);
	}
	:is(.rarity-0,.rarity-1,.rarity-2) & {
		display: none;
	}
}